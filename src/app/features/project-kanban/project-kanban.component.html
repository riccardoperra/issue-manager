<div class="tui-container tui-container_fullwidth tui-space__top-6">
  <div
    class="project-kanban-title"
    *rxLet="project$; let project; strategy: 'local'"
  >
    <tui-breadcrumbs size="l">
      <ng-container *ngFor="let item of breadcrumb">
        <a *tuiBreadcrumb tuiLink [routerLink]="item.routerLink">
          {{ item.caption }}
        </a>
      </ng-container>
      <a
        *tuiBreadcrumb
        tuiLink
        [routerLink]="['/project', project.$id]"
        [routerLinkActiveOptions]="{ exact: true }"
        [routerLinkActive]="'active'"
      >
        {{ project.name }}
      </a>
    </tui-breadcrumbs>
    <h1>{{ project.name }}</h1>
  </div>

  <div
    cdkDropListGroup
    class="tui-space_top-4"
    *rxLet="categories$; let categories; strategy: 'native'"
  >
    <div
      class="list-grid"
      cdkDropList
      [cdkDropListOrientation]="'horizontal'"
      [cdkDropListData]="categories"
      (cdkDropListDropped)="onCategoryDrop($event)"
    >
      <div
        cdkDropListGroup
        class="list-grid"
        *rxLet="groupedCards$; let groupedCards"
      >
        <ng-container
          *rxFor="
            let list of categories;
            strategy: 'native';
            trackBy: categoriesTrackBy;
            let index = index
          "
        >
          <tui-island
            [transparent]="true"
            [cdkDragData]="list"
            cdkDrag
            class="list-wrapper"
          >
            <div #ref>
              <div class="list-header" cdkDragHandle>
                {{ list.name }}

                <div class="list-header-actions">
                  <button size="s" tuiIconButton appearance="secondary">
                    <tui-svg src="tuiIconMoreHorLarge"></tui-svg>
                  </button>
                </div>
              </div>

              <div
                class="tui-island__content"
                [class.tui-space_all-4]="groupedCards[list.$id].length > 0"
              >
                <app-kanban-list
                  [cards]="groupedCards[list.$id]"
                  [list]="list"
                  (dropEvent)="ui.moveCard($event)"
                ></app-kanban-list>
              </div>

              <div class="tui-island__content tui-space_all-4">
                <button
                  tuiButton
                  type="button"
                  appearance="secondary"
                  size="m"
                  class="list-add-new-card-action"
                  [class.first-add]="groupedCards[list.$id].length === 0"
                  (click)="addNew()"
                >
                  <tui-svg src="tuiIconPlus"></tui-svg>
                  Add new card
                </button>
              </div>
            </div>

            <div
              class="list-wrapper-drag-placeholder"
              [style.height.px]="ref.clientHeight"
              *cdkDragPlaceholder
            ></div>
          </tui-island>
        </ng-container>

        <app-kanban-add-list
          class="list-wrapper"
          (confirmEvent)="ui.addCategory($event)"
        ></app-kanban-add-list>
      </div>
    </div>
  </div>
</div>
